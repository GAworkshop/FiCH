/*! Membership 2 Pro - v1.0.32
 * https://premium.wpmudev.org/project/membership/
 * Copyright (c) 2016; * Licensed GPLv2+ */
window.ms_init=window.ms_init||{},jQuery(function(){function e(e){if(void 0!==e&&void 0!==window.ms_init[e]){if(!0===window.ms_init._done[e])return!1;window.ms_init._done[e]=!0,window.ms_init[e]()}}var t;if(window.ms_init._done=window.ms_init._done||{},void 0!==window.ms_data&&void 0!==ms_data.ms_init){if(ms_data.ms_init instanceof Array)for(t=0;ms_data.ms_init.length>t;t+=1)e(ms_data.ms_init[t]);else e(ms_data.ms_init);ms_data.ms_init=[]}}),window.ms_functions={dp_config:{dateFormat:"yy-mm-dd",dayNamesMin:["Sun","Mon","Tue","Wed","Thy","Fri","Sat"],custom_class:"wpmui-datepicker"},chosen_options:{minimumResultsForSearch:6,width:"auto"},init:function(e){var t=window.ms_functions;jQuery(".ms-wrap select, .ms-select",e).each(function(){var e=jQuery(this);e.closest(".no-auto-init").length||e.closest(".manual-init").length||e.wpmuiSelect(t.chosen_options)}),jQuery(".wpmui-datepicker",e).each(function(){var e=jQuery(this);e.closest(".no-auto-init").length||e.ms_datepicker()}),window.setTimeout(function(){jQuery("body").trigger("resize")},50)},ajax_update:function(e){var t,i,a,n=jQuery(e),s=window.ms_functions,r=n;n.hasClass("ms-processing")||(r.parents(".wpmui-radio-wrapper").length?r=r.parents(".wpmui-radio-wrapper").first():r.parents(".wpmui-radio-slider-wrapper").length?r=r.parents(".wpmui-radio-slider-wrapper").first():r.parents(".wpmui-input-wrapper").length?r=r.parents(".wpmui-input-wrapper").first():r.parents("label").length&&(r=r.parents("label").first()),r.addClass("wpmui-loading"),a=s.ajax_show_indicator(n),t=n.data("wpmui-ajax"),n.is(":checkbox")?t.value=n.prop("checked"):(i=n.val(),i instanceof Array||i instanceof Object||null===i?t.values=i:t.value=i),void 0===t.field&&(t.field=n.attr("name")),"function"==typeof n.data("before_ajax")&&(t=n.data("before_ajax")(t,n)),n.trigger("ms-ajax-start",[t,a,r]),jQuery.post(window.ajaxurl,t,function(e){var i=s.ajax_error(e,a);r.removeClass("wpmui-loading"),a.removeClass("ms-processing"),n.trigger("ms-ajax-updated",[t,e,i])}).always(function(){n.trigger("ms-ajax-done",[t,a,r])}))},radio_slider_ajax_update:function(e){var t,i,a,n,s,r=jQuery(e),o=window.ms_functions;r.hasClass("ms-processing")||r.attr("readonly")||(r.toggleClass("on"),r.toggleClass("off"),r.parent().toggleClass("on"),r.parent().toggleClass("off"),r.trigger("change"),a=r.children(".wpmui-toggle"),t=a.data("wpmui-ajax"),n=a.data("states"),null!==t&&void 0!==t?(i=o.ajax_show_indicator(r),r.addClass("ms-processing wpmui-loading"),s=r.hasClass("on"),t.value=void 0!==n.active&&s?n.active:void 0===n.inactive||s?s:n.inactive,"function"==typeof r.data("before_ajax")&&(t=r.data("before_ajax")(t,r)),r.trigger("ms-ajax-start",[t,i,r]),jQuery.post(window.ajaxurl,t,function(e){var a=o.ajax_error(e,i);a&&(r.toggleClass("on"),r.toggleClass("off")),i.removeClass("ms-processing"),r.removeClass("ms-processing wpmui-loading"),r.children("input").val(r.hasClass("on")),t.response=e,r.trigger("ms-ajax-updated",[t,e,a]),r.trigger("ms-radio-slider-updated",[t,a]),r.trigger("wpmui-radio-slider-updated",[t,a])}).always(function(){r.trigger("ms-ajax-done",[t,i,r])})):r.children("input").val(r.hasClass("on")))},dynamic_form_submit:function(e,t){var i,a,n,s,r,o,d=window.ms_functions,l=jQuery(t),u=l.serializeArray(),m={};for(e.preventDefault(),i=0;u.length>i;i+=1)n=u[i].name,a=u[i].value,void 0===m[n]?m[n]=a:(!m[n]instanceof Array&&(m[n]=[m[n]]),m[n].push(a));return m.action="ms_submit",o=l.parents(".wpmui-popup"),s=o.length,s?o.addClass("wpmui-loading"):r=d.ajax_show_indicator(l),jQuery(document).trigger("ms-ajax-form-send",[l,m,s,r]),jQuery.post(window.ajaxurl,m,function(e){var t=d.ajax_error(e,r);o.length&&o.removeClass("wpmui-loading"),t||s&&d.close_dialogs(),jQuery(document).trigger("ms-ajax-form-done",[l,e,t,m,s,r])}),!1},ajax_error:function(e,t){var i=0,a=[],n="",s=window.ms_functions;return isNaN(e)?(a=e.split(":",2),isNaN(a[0])||(i=a[0]),void 0!==a[1]&&(n=a[1])):i=e,0>i?(t&&(t.removeClass("okay").addClass("error"),t.find(".err-code").text(n),s.ajax_hide_message(8e3,t)),!0):(t&&(t.removeClass("error").addClass("okay"),t.find(".err-code").text(""),s.ajax_hide_message(4e3,t)),!1)},ajax_show_indicator:function(e){var t;return window.ms_functions,t=e.nearest(".ms-save-text-wrapper"),null!==t.data("msg_timeout")&&(window.clearTimeout(t.data("msg_timeout")),t.data("msg_timeout",null)),t.addClass("ms-processing"),t.removeClass("error okay"),t},ajax_hide_message:function(e,t){var i;window.ms_functions,isNaN(e)&&(e=4e3),0>e&&(e=0),i=window.setTimeout(function(){var e=t;e.removeClass("error okay")},e),t.data("msg_timeout",i)},select_all:function(e){var t;e=jQuery(e)[0],document.selection?(t=document.body.createTextRange(),t.moveToElementText(e),t.select()):window.getSelection&&(t=document.createRange(),t.selectNode(e),window.getSelection().addRange(t))},toggle_box:function(e,t){var i=jQuery(t),a=i.closest(".ms-settings-box");return a.hasClass("static")?!1:(a.hasClass("closed")?a.removeClass("closed").addClass("open"):a.removeClass("open").addClass("closed"),void 0)},toggle_datepicker:function(e){var t=jQuery(e),i=t.closest(".wpmui-datepicker-wrapper").find(".wpmui-datepicker");i.datepicker("show")},tag_selector_add:function(e){var t=window.ms_functions,i=jQuery(this).closest(".wpmui-tag-selector-wrapper"),a=i.find("select.wpmui-tag-source"),n=i.find("select.wpmui-tag-data"),s=n.val()||[];a.val().length&&(s.push(a.val()),n.val(s).trigger("change"),a.val("").trigger("change"),t.tag_selector_refresh_source(e,this))},tag_selector_refresh_source:function(e,t){var i=0,a=null,n=jQuery(t).closest(".wpmui-tag-selector-wrapper"),s=n.find("select.wpmui-tag-source"),r=s.find("option"),o=n.find("select.wpmui-tag-data"),d=o.val()||[];for(i=0;r.length>i;i+=1)a=jQuery(r[i]),-1!==jQuery.inArray(a.val(),d)?a.prop("disabled",!0):a.prop("disabled",!1);s.trigger("change")},reload:function(){window.location.reload()},show_dialog:function(e){var t,i=jQuery(this),a=(window.ms_functions,{});if(e.preventDefault(),t=i.attr("data-ms-data"),void 0!==t)try{a=jQuery.parseJSON(t)}catch(n){a={}}return a.action="ms_dialog",a.dialog=i.attr("data-ms-dialog"),jQuery(document).trigger("ms-load-dialog",[a]),i.addClass("wpmui-loading"),jQuery.post(window.ajaxurl,a,function(e){var t,a=!1;i.removeClass("wpmui-loading");try{a=jQuery.parseJSON(e)}catch(n){a=!1}a.title=a.title||"Dialog",a.height=a.height||100,a.width=a.width>0?a.width:void 0,a.content=a.content||"",a.modal=a.modal||!0,t=wpmUi.popup().modal(!0,!a.modal).title(a.title).size(a.width,a.height).content(a.content).show()}),!1},close_dialogs:function(){var e,t=wpmUi.popups();for(e in t)t[e].close()},update_view_count:function(e,t){var i=jQuery(this),a=i.closest(".wp-list-table"),n=a.closest("form"),s=n.parent(),r=s.find(".subsubsub").first(),o=r.find(".has_access .count"),d=r.find(".no_access .count"),l=parseInt(o.text().replace(/\D/,"")),u=parseInt(d.text().replace(/\D/,""));isNaN(l)&&(l=0),isNaN(u)&&(u=0),t.value?(u-=1,l+=1):(u+=1,l-=1),0>l&&(l=0),0>u&&(u=0),0===l?o.text(""):o.text("("+l+")"),0===u?d.text(""):d.text("("+u+")")},submit_form:function(){var e=jQuery(this),t=e.data("form"),i=jQuery("form."+t);i.length&&i.submit()}},jQuery.fn.ms_datepicker=function(e){var t=null,i=window.ms_functions,a=jQuery.extend(i.dp_config,e);return"function"==typeof a.beforeShow&&(t=a.beforeShow),a.beforeShow=function(e,i){void 0!==i&&void 0!==i.dpDiv&&jQuery(i.dpDiv).addClass(a.custom_class),window.setTimeout(function(){jQuery(i.dpDiv).css({"z-index":"10"})},20),null!==t&&t(e,i)},this.each(function(){jQuery(this).datepicker(a)})},jQuery(document).ready(function(){var e=window.ms_functions;jQuery("body").on("click",".wpmui-radio-slider",function(){e.radio_slider_ajax_update(this)}).on("click",".ms-settings-box .handlediv",function(t){e.toggle_box(t,this)}).on("click",".wpmui-datepicker-wrapper .wpmui-icon",function(){e.toggle_datepicker(this)}).on("select2-opening",".wpmui-tag-selector-wrapper .wpmui-tag-data",function(e){e.preventDefault()}).on("change",".wpmui-tag-selector-wrapper .wpmui-tag-data",function(t){e.tag_selector_refresh_source(t,this)}).on("click",".wpmui-tag-selector-wrapper .wpmui-tag-button",e.tag_selector_add).on("change","input.wpmui-ajax-update:not([type=number]), select.wpmui-ajax-update, textarea.wpmui-ajax-update",function(){e.ajax_update(this)}).on("blur",'input.wpmui-ajax-update[type="number"]',function(){var t=jQuery(this);t.val()!==t.data("val")&&(t.data("val",t.val()),e.ajax_update(this))}).on("change",'input.wpmui-ajax-update[type="number"]',function(){var e=jQuery(this);e.focus()}).on("focus",'input.wpmui-ajax-update[type="number"]',function(){var e=jQuery(this);void 0===e.data("val")&&e.data("val",e.val())}).on("click","button.wpmui-ajax-update",function(){e.ajax_update(this)}).on("submit","form.wpmui-ajax-update",function(t){e.dynamic_form_submit(t,this)}).on("click","[data-ms-dialog]",e.show_dialog).on("ms-radio-slider-updated",".wp-list-table.rules .wpmui-radio-slider",e.update_view_count).on("click",".ms-submit-form",e.submit_form),jQuery(".ms-wrap").on("click","code",function(){e.select_all(this)}),e.init("body"),jQuery("html").addClass("ms-html")}),function(){var e=null,t=null,i=null;window.ms_inline_editor={init:function(){i=jQuery(".ms-wrap #inline-edit"),i.detach(),i.keyup(function(e){return 27===e.which?ms_inline_editor.revert():void 0}),jQuery("a.cancel",i).click(function(){return ms_inline_editor.revert()}),jQuery("a.save",i).click(function(){return ms_inline_editor.save(this)}),jQuery("td",i).keydown(function(e){return 13===e.which?ms_inline_editor.save(this):void 0}),jQuery(".ms-wrap .wp-list-table").on("click","a.editinline",function(){return ms_inline_editor.edit(this),!1})},edit:function(a){var n,s;return ms_inline_editor.revert(),"object"==typeof a&&(a=ms_inline_editor.get_id(a)),e=i.clone(!0),t=jQuery("#item-"+a),jQuery("td",e).attr("colspan",jQuery(".widefat:first thead th:visible").length),t.hasClass("alternate")&&e.addClass("alternate"),t.hide().after(e),s={},n=t.find(".inline_data"),n.children().each(function(){var t=jQuery(this),i=t.attr("class"),a=e.find(':input[name="'+i+'"]'),n=e.find(".lbl-"+i);s[i]=t.text(),a.length&&a.val(s[i]),n.length&&n.text(s[i])}),jQuery(document).trigger("ms-inline-editor",[e,t,s]),e.attr("id","edit-"+a).addClass("inline-editor").show(),e.find(":input:visible").first().focus(),!1},save:function(i){var a;return"object"==typeof i&&(i=ms_inline_editor.get_id(i)),e.find("td").addClass("wpmui-loading"),a=e.find(":input").serialize(),jQuery.post(window.ajaxurl,a,function(i){e.find("td").removeClass("wpmui-loading"),i?-1!==i.indexOf("<tr")?(t.remove(),t=jQuery(i),e.before(t).remove(),t.hide().fadeIn(),ms_inline_editor.update_alternate(t),jQuery(document).trigger("ms-inline-editor-updated",[t])):(i=i.replace(/<.[^<>]*?>/g,""),e.find(".error").html(i).show()):e.find(".error").html(ms_data.lang.quickedit_error).show(),t.prev().hasClass("alternate")&&t.removeClass("alternate")},"html"),!1},revert:function(){return e&&(e.remove(),t.show(),e=null,t=null),!1},update_alternate:function(e){var t,i,a,n=jQuery(e).closest("tbody"),s=n.find("tr:visible");for(t=0,i=s.length;i>t;t++)a=jQuery(s[t]),0===t%2?a.addClass("alternate"):a.removeClass("alternate")},get_id:function(e){var t=jQuery(e).closest("tr").attr("id"),i=t.split("-");return i[i.length-1]}},jQuery(function(){ms_inline_editor.init()})}(),jQuery(function(){jQuery(document).click(function(){function e(){var e=jQuery(this),t=e.attr("timestamp"),i=jQuery('.wpmui-tooltip-wrapper[timestamp="'+t+'"]').first();e.hide(),e.appendTo(jQuery(i))}jQuery(".wpmui-tooltip[timestamp]").each(e)}),jQuery(".wpmui-tooltip-button").click(function(){var e=jQuery(this),t=e.parents(".wpmui-tooltip"),i=jQuery(t).attr("timestamp"),a=jQuery('.wpmui-tooltip-wrapper[timestamp="'+i+'"]').first();jQuery(t).hide(),jQuery(t).appendTo(jQuery(a))}),jQuery(".wpmui-tooltip").click(function(e){e.stopPropagation()}),jQuery(".wpmui-tooltip-info").click(function(e){var t,i,a,n,s,r=jQuery(this);r.toggleClass("open"),r.hasClass("open")?(r.parents(".wpmui-tooltip-wrapper").attr("timestamp",e.timeStamp),e.stopPropagation(),s=r.siblings(".wpmui-tooltip"),s.attr("timestamp",e.timeStamp),n=r.offset(),s.appendTo("#wpcontent"),s.css({left:n.left+25,top:n.top-40}),s.fadeIn(300)):(t=r.parents(".wpmui-tooltip-wrapper"),i=jQuery(t).attr("timestamp"),a=jQuery('.wpmui-tooltip[timestamp="'+i+'"]').first(),jQuery(a).hide(),jQuery(a).appendTo(jQuery(t)))})}),window.ms_init.controller_adminbar=function(){function e(e){var t=e.currentTarget.value,i=jQuery("#wpadminbar #view-as-selector").find('option[value="'+t+'"]').attr("nonce");jQuery("#wpadminbar #ab-membership-id").val(t),jQuery("#wpadminbar #view-site-as #_wpnonce").val(i),jQuery("#wpadminbar #view-site-as").submit()}jQuery("#wp-admin-bar-membership-simulate").find("a").click(function(){jQuery("#wp-admin-bar-membership-simulate").removeClass("hover").find("> div").filter(":first-child").html(ms_data.switching_text)}),jQuery(".ms-date").ms_datepicker(),jQuery("#wpadminbar #view-site-as").parents("#wpadminbar").addClass("simulation-mode"),jQuery("#wpadminbar #view-as-selector").change(e)},window.ms_init.view_help=function(){function e(){var e=jQuery(this),t=e.parents(".ms-help-box").first(),i=t.find(".ms-help-details");i.toggle()}jQuery(".ms-help-toggle").click(e)},window.ms_init.view_billing_edit=function(){var e={onkeyup:!1,errorClass:"ms-validation-error",rules:{name:"required",user_id:{required:!0,min:1},membership_id:{required:!0,min:1},amount:{required:!0,min:0},due_date:{required:!0,dateISO:!0}}};jQuery(".ms-form").validate(e)},window.ms_init.view_billing_transactions=function(){function e(){var e=wpmUi.ajax(),i=e.extract_data(l);return l.addClass("wpmui-loading"),jQuery.post(window.ajaxurl,i,function(e){e.success&&(wpmUi.message(e.data.message),t())},"json").always(function(){l.removeClass("wpmui-loading")}),!1}function t(){function e(){if(!r.length)return a.$().remove(),void 0;var t=r.shift(),i=jQuery.extend({},s),o=d.find("#item-"+t);i.id=t,n+=1,a.value(n),jQuery.post(window.ajaxurl,i,function(t){t.success&&t.data.desc&&(o.removeClass("log-err log-ignore log-ok"),o.addClass("log-"+t.data.state),o.find(".column-note .txt").text(t.data.desc)),window.setTimeout(function(){e()},1)},"json").always(function(){o.find(".column-note").removeClass("wpmui-loading")})}var t=d.find(".item"),i=l.find(".retry_nonce").val(),a=wpmUi.progressbar(),n=0,s={},r=[];s.action="transaction_retry",s._wpnonce=i,t.each(function(){var e=jQuery(this),t=e.attr("id").replace(/^item-/,"");e.find(".column-note").addClass("wpmui-loading"),r.push(t)}),a.value(0),a.max(r.length),a.$().insertBefore(l),l.hide(),e()}function i(){var e=jQuery(this).closest("td"),t=e.find("input[name=nonce_update]").val(),i=e.closest(".item"),a=i.attr("id").replace(/^item-/,""),n={};return i.hasClass("log-ignore")?(n.action="transaction_update",n._wpnonce=t,n.id=a,n.state="clear",e.addClass("wpmui-loading"),jQuery.post(window.ajaxurl,n,function(){i.removeClass("log-ignore is-manual").addClass("log-err")}).always(function(){e.removeClass("wpmui-loading")}),!1):!1}function a(){var e=jQuery(this).closest("td"),t=e.find("input[name=nonce_update]").val(),i=e.closest(".item"),a=i.attr("id").replace(/^item-/,""),n={};return i.hasClass("log-err")?(n.action="transaction_update",n._wpnonce=t,n.id=a,n.state="ignore",e.addClass("wpmui-loading"),jQuery.post(window.ajaxurl,n,function(){i.removeClass("log-err").addClass("log-ignore is-manual")}).always(function(){e.removeClass("wpmui-loading")}),!1):!1}function n(){var e=jQuery(this).closest("td"),t=e.find("input[name=nonce_retry]").val(),i=e.closest(".item"),a=i.attr("id").replace(/^item-/,""),n={};return i.hasClass("log-err")||i.hasClass("log-ignore")?(n.action="transaction_retry",n._wpnonce=t,n.id=a,e.addClass("wpmui-loading"),jQuery.post(window.ajaxurl,n,function(e){e.success&&e.data.desc&&(i.removeClass("log-err log-ignore log-ok"),i.addClass("log-"+e.data.state),i.find(".column-note .txt").text(e.data.desc))},"json").always(function(){e.removeClass("wpmui-loading")}),!1):!1}function s(){var e=jQuery(this).closest("td"),t=e.find("input[name=nonce_link]").val(),i=e.closest(".item"),a=i.attr("id").replace(/^item-/,""),n={};return i.hasClass("log-err")?(n.action="transaction_link",n._wpnonce=t,n.id=a,e.addClass("wpmui-loading"),jQuery.post(window.ajaxurl,n,function(e){e.length&&r(i,e)}).always(function(){e.removeClass("wpmui-loading")}),!1):!1}function r(e,t){function i(){var e,t=r.val();return isNaN(t)||1>t?(h.find(".wpmui-label-after").hide(),p.hide(),h.hide(),!1):(e={action:"transaction_link_data",_wpnonce:u.val(),get:"subscriptions","for":t},d.empty(),l.empty(),p.show().addClass("wpmui-loading"),h.find(".wpmui-label-after").hide(),h.hide(),f.prop("disabled",!0).addClass("disabled"),jQuery.post(window.ajaxurl,e,function(e){jQuery.each(e,function(e,t){o(d,e,t)})},"json").always(function(){p.removeClass("wpmui-loading")}),void 0)}function a(){var e,t=d.val();return isNaN(t)||1>t?(h.find(".wpmui-label-after").hide(),h.hide(),!1):(e={action:"transaction_link_data",_wpnonce:u.val(),get:"invoices","for":t},l.empty(),h.show().addClass("wpmui-loading"),h.find(".wpmui-label-after").hide(),f.prop("disabled",!0).addClass("disabled"),jQuery.post(window.ajaxurl,e,function(e){window.console.log(e),jQuery.each(e,function(e,t){window.console.log(e,t),o(l,e,t)})},"json").always(function(){h.removeClass("wpmui-loading")}),void 0)}function n(){var e=l.val();!isNaN(e)&&e>0?(h.find(".wpmui-label-after").show(),f.prop("disabled",!1).removeClass("disabled")):(h.find(".wpmui-label-after").hide(),f.prop("disabled",!0).addClass("disabled"))}function s(){var t={action:"transaction_update",_wpnonce:m.val(),id:g.val(),link:l.val()};return t.link?(w.addClass("wpmui-loading"),jQuery.post(window.ajaxurl,t,function(t){"3"===t&&(e.removeClass("log-err").addClass("log-ok is-manual"),v.close())}).always(function(){w.removeClass("wpmui-loading")}),void 0):!1}var r,d,l,u,m,c,p,h,f,g,v=wpmUi.popup(),w=v.$();v.modal(!0),v.title(ms_data.lang.link_title),v.content(t),v.show(),r=w.find("select[name=user_id]"),d=w.find("select[name=subscription_id]"),l=w.find("select[name=invoice_id]"),c=w.find(".link-member"),p=w.find(".link-subscription"),h=w.find(".link-invoice"),u=w.find("input[name=nonce_link_data]"),m=w.find("input[name=nonce_update]"),g=w.find("input[name=log_id]"),f=w.find("button[name=submit]"),p.hide(),h.hide(),f.prop("disabled",!0).addClass("disabled"),r.change(i),d.change(a),l.change(n),f.click(s),!isNaN(r.val())&&r.val()>0&&i()}function o(e,t,i){if("object"==typeof i){var a=jQuery("<optgroup></optgroup>");a.attr("label",t),jQuery.each(i,function(e,t){o(a,e,t)}),e.append(a)}else e.append(jQuery("<option></option>").val(t).html(i))}var d=jQuery(".wp-list-table.transactions, .wp-list-table.transaction_matches"),l=jQuery(".transaction-matching"),u=d.find(".action-clear"),m=d.find(".action-ignore"),c=d.find(".action-link"),p=d.find(".action-retry"),h=l.find(".action-match");u.click(i),m.click(a),c.click(s),p.click(n),h.click(e)},window.ms_init.view_member_date=function(){jQuery(".ms-date").ms_datepicker()},window.ms_init.view_member_editor=function(){function e(e,i){var a=i.val(),n={},s=i.closest(".wpmui-wrapper");n.action="member_validate_field",n.field=e,n.value=a,s.addClass("wpmui-loading"),jQuery.post(window.ajaxurl,n,function(e){var a=s.find(".wpmui-label-after");s.removeClass("wpmui-loading"),"1"===e?(i.removeClass("invalid"),i.addClass("valid"),a.html("")):(i.removeClass("valid"),i.addClass("invalid"),a.html(e)),t()})}function t(){i.hasClass("valid")&&a.hasClass("valid")?(s.prop("disabled",!1),s.removeClass("disabled")):(s.prop("disabled",!0),s.addClass("disabled")),n.val()?(r.prop("disabled",!1),r.removeClass("disabled")):(r.prop("disabled",!0),r.addClass("disabled"))}var i=jQuery("#username"),a=jQuery("#email"),n=jQuery(".ms-group-select #user_id"),s=jQuery("#btn_create"),r=jQuery("#btn_select"),o={};i.change(function(){e("username",i)}),a.change(function(){e("email",a)}),n.change(t),o.minimumInputLength=3,o.multiple=!1,o.ajax={url:window.ajaxurl,dataType:"json",type:"GET",delay:100,data:function(e){return{action:"member_search",q:e.term,p:e.page}},processResults:function(e){return{results:e.items,more:e.more}}},n.removeClass("wpmui-hidden"),n.wpmuiSelect(o),t()},window.ms_init.view_member_list=function(){window.ms_init.memberships_column(".column-membership")},window.ms_init.view_membership_add=function(){var e=jQuery("input#public"),t=e.closest(".opt"),i=jQuery("input#paid"),a=jQuery("input#name"),n=a.closest(".opt"),s=i.closest(".opt");jQuery("#ms-choose-type-form").validate({onkeyup:!1,errorClass:"ms-validation-error",rules:{name:{required:!0}}}),jQuery('input[name="type"]').click(function(){var r=jQuery('input[name="type"]'),o=r.filter(":checked"),d=o.val();r.closest(".wpmui-radio-input-wrapper").removeClass("active"),o.closest(".wpmui-radio-input-wrapper").addClass("active"),"guest"===d||"user"===d?(e.prop("disabled",!0),i.prop("disabled",!0),a.prop("readonly",!0),t.addClass("disabled ms-locked"),s.addClass("disabled ms-locked"),n.addClass("disabled ms-locked"),a.val(o.next(".wpmui-radio-caption").text())):(e.prop("disabled",!1),i.prop("disabled",!1),a.prop("readonly",!1),t.removeClass("disabled ms-locked"),s.removeClass("disabled ms-locked"),n.removeClass("disabled ms-locked"),a.val("").focus())}).filter(":checked").trigger("click"),jQuery("#cancel").click(function(){var e=jQuery(this);e.on("ms-ajax-updated",function(){window.location=ms_data.initial_url}),ms_functions.ajax_update(e)})},window.ms_init.view_membership_list=function(){function e(e){var t,i=jQuery(this),a=i.parents("tr"),n=a.find(".column-name .the-name").text(),s=i.attr("href");return e.preventDefault(),t={message:ms_data.lang.msg_delete.replace("%s",n),buttons:[ms_data.lang.btn_delete,ms_data.lang.btn_cancel],callback:function(e){0===e&&(window.location=s)}},wpmUi.confirm(t),!1}var t=jQuery("#the-list-membership");t.on("click",".delete a",e),jQuery(document).on("ms-ajax-form-done",function(e,t,i,a){a||window.location.reload()})},window.ms_init.bulk_delete_membership=function(){function e(e){var t,a=jQuery(this);return a.parents("tr"),a.attr("href"),e.preventDefault(),t={message:ms_data.lang.msg_bulk_delete,buttons:[ms_data.lang.btn_delete,ms_data.lang.btn_cancel],callback:function(e){0===e&&(window.location=i())}},wpmUi.confirm(t),!1}var t=jQuery(".bulk_delete_memberships_button").attr("href"),i=function(){var e=[];return jQuery("input.del_membership_ids:checked").each(function(){e.push(jQuery(this).val())}),e.length>0?t+"&membership_ids="+e.join("-"):t};jQuery(".bulk_delete_memberships_button").click(e)},window.ms_init.metabox=function(){function e(){var e=i.filter(".on,.wpmui-loading").length;e?(a.show(),t.addClass("on")):(a.hide(),t.removeClass("on"))}var t=jQuery(".ms-protect-content"),i=jQuery(".ms-protection-rule"),a=jQuery("#ms-metabox-access-wrapper");t.hasClass("on")?a.show():a.hide(),jQuery(".dripped").click(function(){var e=jQuery(this).children(".tooltip");e.toggle(300)}),window.ms_init.ms_metabox_event=function(e,i){jQuery("#ms-metabox-wrapper").replaceWith(i.response),window.ms_init.metabox(),jQuery(".wpmui-radio-slider").click(function(){window.ms_functions.radio_slider_ajax_update(this)}),t.on("ms-radio-slider-updated",function(e,t){window.ms_init.ms_metabox_event(e,t)})},t.on("ms-radio-slider-updated",function(e,t){window.ms_init.ms_metabox_event(e,t)}),i.on("ms-radio-slider-updated",function(t,i){e(t,i)})},window.ms_init.view_membership_overview=function(){jQuery(".wpmui-radio-slider").on("ms-radio-slider-updated",function(){var e=this,t=jQuery("#ms-membership-status");jQuery(e).hasClass("on")?t.addClass("ms-active"):t.removeClass("ms-active")}),jQuery(document).on("ms-ajax-form-done",function(e,t,i,a){a||window.location.reload()})},window.ms_init.view_membership_urlgroup=function(){var e=!1;ms_functions.test_url=function(){e&&window.clearTimeout(e),e=window.setTimeout(function(){var e=jQuery("#url-test-results-wrapper"),t=jQuery.trim(jQuery("#url_test").val()),i=jQuery("#rule_value").val().split("\n"),a=jQuery("#is_regex").val();a="true"===a||"1"===a?!0:!1,e.empty().hide(),""!==t&&(jQuery.each(i,function(i,n){var s,r,o,d,l;n=jQuery.trim(n),""!==n&&(s=jQuery("<div />").addClass("ms-rule-test"),o=jQuery("<span />").appendTo(s).text(n).addClass("ms-test-url"),r=jQuery("<span />").appendTo(s).addClass("ms-test-result"),l=!1,a?(d=RegExp(n,"i"),l=d.test(t)):l=t.indexOf(n)>=0,l?(s.addClass("ms-rule-valid"),r.text(ms_data.valid_rule_msg)):(s.addClass("ms-rule-invalid"),r.text(ms_data.invalid_rule_msg)),e.append(s))}),e.find("> div").length||e.html("<div><i>"+ms_data.empty_msg+"</i></div>"),e.show())},500)},jQuery("#url_test, #rule_value").keyup(ms_functions.test_url)},window.ms_init.view_membership_payment=function(){function e(){var e=jQuery(this),t=e.closest(".ms-payment-form"),i=e.val(),a=t.find(".ms-payment-type-wrapper"),n=t.find(".ms-payment-type-"+i),s=t.find(".ms-payment-types-wrapper");a.hide(),n.show(),"permanent"===i?s.hide():s.show()}function t(){var e=jQuery(this).val(),t=jQuery(".ms-payment-structure-wrapper");switch(e){case"USD":e="$";break;case"EUR":e="&euro;";break;case"JPY":e="&yen;"}t.find(".wpmui-label-before").html(e)}function i(e,t){t.value?jQuery(".ms-trial-period-details").show():jQuery(".ms-trial-period-details").hide()}function a(e,t,i,a){a||(jQuery(".ms-specific-payment-wrapper").addClass("wpmui-loading"),window.location.reload())}jQuery("#payment_type").change(e),jQuery("#payment_type").each(e),jQuery("#currency").change(t),jQuery(".wpmui-slider-trial_period_enabled").on("ms-radio-slider-updated",i),jQuery(document).on("ms-ajax-updated","#enable_trial_addon",a)},window.ms_init.view_protected_content=function(){function e(){var e,t,i=jQuery(this).closest(".column-access"),a=i.closest("tr.item"),n=i.find("select.ms-memberships"),s=n.val(),r=0;if(s&&s.length)for(e in s)t=s[e],void 0!==ms_data.dripped[t]&&(r+=1);r>1?a.addClass("ms-dripped"):1===r?a.addClass("ms-dripped"):a.removeClass("ms-dripped")}function t(e,t,a,n){var s,r,o=a.find("select.ms-memberships option:selected"),d=t.find(".dripped-form"),l=t.find(".dynamic-form");for(s=0,r=o.length;r>s;s++){var u=jQuery(o[s]),m=u.val(),c=u.data("color"),p=d.clone(!1),h="ms_"+m;void 0!==ms_data.dripped[m]&&(p.find(".the-name").text(ms_data.dripped[m]).css({background:c}),p.find("[name=membership_ids]").attr("name","membership_ids[]").val(m),p.find("[name=item_id]").val(n.item_id),p.find("[name=offset]").val(n.offset),p.find("[name=number]").val(n.number),p.find("[name=dripped_type]").attr("name",h+"[dripped_type]").val(n[h+"[dripped_type]"]),p.find("[name=date]").attr("name",h+"[date]").val(n[h+"[date]"]),p.find("[name=delay_unit]").attr("name",h+"[delay_unit]").val(n[h+"[delay_unit]"]),p.find("[name=delay_type]").attr("name",h+"[delay_type]").val(n[h+"[delay_type]"]),p.appendTo(l).removeClass("hidden"),i(p))}d.remove()}function i(e){var t=e.find("select.dripped_type"),i=e.find(".wpmui-datepicker");t.change(function(){var e=jQuery(this),t=e.val(),i=e.closest(".dripped-form").find(".drip-option");i.removeClass("active"),i.filter("."+t).addClass("active")}).trigger("change"),i.ms_datepicker()}function a(t,i){window.ms_init.memberships_column(".column-access"),i.find(".ms-memberships").each(function(){e.apply(this)})}function n(){var e=r.val();window.location.href=e,r.addClass("wpmui-loading")}var s=jQuery(".wp-list-table"),r=jQuery("#select-site");window.ms_init.memberships_column(".column-access"),s.on("ms-ajax-updated",".ms-memberships",e),s.find(".ms-memberships").each(function(){e.apply(this)}),jQuery(document).on("ms-inline-editor",t),jQuery(document).on("ms-inline-editor-updated",a),r.on("change",n)},window.ms_init.memberships_column=function(e){function t(){var t=jQuery(this).closest(e),i=t.closest("tr.item"),a=t.find("select.ms-memberships");i.removeClass("ms-empty").addClass("ms-assigned"),t.addClass("ms-focused"),a.wpmuiSelect("focus"),a.wpmuiSelect("open")}function i(){var t=jQuery(this).closest(e),i=t.closest("tr.item"),a=t.find("select.ms-memberships"),n=a.val();t.removeClass("ms-focused"),n&&n.length||i.removeClass("ms-assigned").addClass("ms-empty")}function a(e){var t,i=e.element;return t='class="val" style="background: '+jQuery(i).data("color")+'"',"<span "+t+">&emsp;</span> "+e.text}function n(e,t){var i=e.element;return t.css({background:jQuery(i).data("color")}),t.addClass("val"),'<span class="txt">'+e.text+"</span>"}var s=jQuery(".wp-list-table");s.on("click",".ms-empty-note-wrapper .wpmui-label-after",t),s.on("ms-ajax-updated",".ms-memberships",i),s.on("blur",".ms-memberships",function(e){var t=jQuery(this);window.setTimeout(function(){i.apply(t,e)},250)}),jQuery("select.ms-memberships").wpmuiSelect({templateResult:a,templateSelection:n,escapeMarkup:function(e){return e},dropdownCssClass:"ms-memberships wpmui-select2",width:"100%"})},window.ms_init.view_membership_upgrade=function(){function e(){var e=jQuery(this),t=e.hasClass("on"),i=e.closest(".ms-allow"),a=i.next(".ms-update-replace");a.length&&(t?a.hide():a.show())}var t=jQuery(".ms-allow .wpmui-radio-slider");t.on("ms-radio-slider-updated",e),t.each(function(){e.apply(this)})},window.ms_init.view_addons=function(){function e(e,t,i){switch(t){case"options":i.hide().filter(".ms-options").show()}}function t(e,t,i,a){a.removeClass("wpmui-loading"),n.addClass("wpmui-loading")}function i(){n.removeClass("wpmui-loading")}function a(e){var t=jQuery(e.target),i=t.closest(".list-card-top"),a=i.find(".details"),n=a.find(".wpmui-ajax-update-wrapper");t.hasClass("wpmui-ajax-update")||(t=t.find(".wpmui-ajax-update")),t.closest(".details").length||(t.hasClass("on")?n.removeClass("disabled"):n.addClass("disabled"))}var n=jQuery(".ms-addon-list");jQuery(document).on("list-filter",e),jQuery(document).on("ms-ajax-start",t),jQuery(document).on("ms-ajax-updated",a),jQuery(document).on("ms-ajax-done",i),jQuery(".list-card-top .wpmui-ajax-update-wrapper").each(function(){jQuery(this).trigger("ms-ajax-updated")})},window.ms_init.view_settings=function(){function e(){var e=jQuery("select.wpmui-wp-pages"),t=e.map(function(){return jQuery(this).val()});e.each(function(){var e,i=jQuery(this),a=i.find("option"),n=i.parents(".ms-settings-page-wrapper").first(),s=n.find(".ms-action a"),r=i.val();for(a.prop("disabled",!1),e=0;t.length>e;e+=1)r!==t[e]&&a.filter('[value="'+t[e]+'"]').prop("disabled",!0);s.each(function(){var e=jQuery(this),t=e.data("wpmui-ajax"),i=t.base+r;void 0===r||isNaN(r)||1>r?(e.addClass("disabled"),e.attr("href","")):(e.removeClass("disabled"),e.attr("href",i))})})}function t(e){var t=jQuery(this);return t.hasClass("disabled")||!t.attr("href").length?(e.preventDefault(),!1):void 0}function i(){window.location=ms_data.initial_url}function a(e,t){t.value?(jQuery("#wp-admin-bar-ms-unprotected").hide(),jQuery("#wp-admin-bar-ms-test-memberships").show()):(jQuery("#wp-admin-bar-ms-unprotected").show(),jQuery("#wp-admin-bar-ms-test-memberships").hide())}jQuery("#initial_setup").on("ms-ajax-updated",i),jQuery(".wpmui-slider-plugin_enabled").on("ms-radio-slider-updated",a),jQuery(".wpmui-wp-pages").on("ms-ajax-updated",e),jQuery(".ms-action a").on("click",t),jQuery(function(){e()})},window.ms_init.view_settings_automated_msg=function(){function e(){var e=jQuery(this),t=e.closest("form"),i=0;for(i=0;window.tinymce.editors.length>i;i+=1)if(window.tinymce.editors[i].isDirty()){a=!0;break}return a&&!window.confirm(ms_data.lang_confirm)?!1:(t.submit(),void 0)}function t(){a=!0}function i(){var e=jQuery(this),t=e.closest(".ms-settings-wrapper"),i=t.find(".ms-editor-form");e.hasClass("on")?i.show():i.hide()}var a=!1;jQuery("#switch_comm_type").click(e),jQuery("input, select, textarea",".ms-editor-form").change(t),jQuery(".override-slider").each(function(){i.apply(this)}).on("ms-ajax-done",i),window.tinymce.PluginManager.add("ms_variable",function(e){function t(){e.insertContent(this.value())}var i,a,n=[];for(i in ms_data.var_button.items)ms_data.var_button.items.hasOwnProperty(i)&&(a=ms_data.var_button.items[i],n.push({text:a,value:i,onclick:t}));
e.addButton("ms_variable",{text:ms_data.var_button.title,icon:!1,type:"menubutton",menu:n})})},window.ms_init.view_settings_import=function(){function e(){var e=document.createElement("a");return void 0===e.download?!1:void 0===window.Blob?!1:void 0===window.JSON?!1:void 0===window.JSON.stringify?!1:!0}function t(t,i,a){var n,s;return e()?(a||(a="application/octet-stream"),n=document.createElement("a"),s=new window.Blob([t],{type:a}),n.href=window.URL.createObjectURL(s),n.download=i,n.click(),void 0):!1}function i(){var e;void 0!==window._ms_import_obj&&(e=window.JSON.stringify(window._ms_import_obj),t(e,"protected-content.json"))}function a(){var e=jQuery("<div></div>");h=wpmUi.progressbar(),e.append(h.$()),p=wpmUi.popup().title(ms_data.lang.progress_title,!1).modal(!0,!1).content(e,!0).size(600,140).show()}function n(){var e=jQuery('<div style="text-align:center"></div>'),t=jQuery('<a href="#" class="close"></a>');t.text(ms_data.lang.close_progress),ms_data.close_link&&t.attr("href",ms_data.close_link),t.addClass("button-primary"),t.appendTo(e),p.content(e,!0).modal(!0,!0).title(ms_data.lang.import_done)}function s(e){var t,i={},a=0;for(i.items=[],i.item_count=0,i.label="",i.source=window._ms_import_obj.source_key,a=0;e>a&&(t=f.shift(),void 0!==t);a+=1)i.label=t.label,delete t.label,i.items.push(t),i.item_count+=1;return i}function r(){var e='<i class="wpmui-loading-icon"></i> ',t=c.val(),i=s(t);return i.item_count?(h.value(g-f.length).label(e+"<span>"+i.label+"</span>"),i.action=u.val(),delete i.label,jQuery.post(window.ajaxurl,i,r),void 0):(n(),void 0)}function o(){var e,t,i,n=ms_data.lang;f=[],f.push({task:"start",clear:m.is(":checked"),label:n.task_start}),i=0;for(e in window._ms_import_obj.memberships)t=window._ms_import_obj.memberships[e],i+=1,f.push({task:"import-membership",data:t,label:n.task_import_membership+": "+i+"..."});i=0;for(e in window._ms_import_obj.members)t=window._ms_import_obj.members[e],i+=1,f.push({task:"import-member",data:t,label:n.task_import_member+": "+i+"..."});for(e in window._ms_import_obj.settings)t=window._ms_import_obj.settings[e],f.push({task:"import-settings",setting:e,value:t,label:n.task_import_settings+"..."});f.push({task:"done",label:n.task_done}),a(),g=f.length,h.max(g),r()}var d=jQuery(".ms-settings-import"),l=d.find("#btn-download"),u=d.find("#btn-import"),m=d.find("#clear_all"),c=d.find("#batchsize"),p=null,h=null,f=[],g=0;e()?l.click(i):l.hide(),u.click(o)},window.ms_init.view_settings_mailchimp=function(){jQuery("#mailchimp_api_key").on("ms-ajax-updated",ms_functions.reload)},window.ms_init.view_settings_payment=function(){function e(e,t,i,a){if(void 0!==t.gateway_id&&"update_gateway"===t.action){var n=jQuery(".gateway-"+t.gateway_id);a?n.removeClass("is-configured is-live is-sandbox").addClass("not-configured"):(n.removeClass("not-configured").addClass("is-configured"),"sandbox"===t.value?n.removeClass("is-live").addClass("is-sandbox"):"live"===t.value&&n.removeClass("is-sandbox").addClass("is-live"))}}function t(){var e=jQuery(this),t=e.closest(".ms-gateway-item");e.prop("checked")?t.addClass("open"):t.removeClass("open")}function i(){var e=jQuery("#secure_cc").val();"false"!==e&&e?(jQuery(".secure_cc_off").hide(),jQuery(".secure_cc_on").removeClass("hidden").show()):(jQuery(".secure_cc_on").hide(),jQuery(".secure_cc_off").removeClass("hidden").show())}jQuery(document).on("ms-ajax-updated",e),jQuery(document).on("click",".show-settings",t),jQuery(".wpmui-slider-secure_cc").on("ms-ajax-done",i),i()},window.ms_init.view_settings_protection=function(){function e(e){var t=jQuery("#"+e.type),i=t.closest(".wp-editor-wrap"),a=window.tinyMCE.get(e.type);return a&&i.hasClass("tmce-active")&&a.save(),e.value=t.val(),e}function t(){var e=jQuery(this),t=e.closest(".inside"),i=t.find(".wp-editor-wrap"),a=t.find(".button-primary");e.hasClass("on")?(a.show(),i.show()):(a.hide(),i.hide())}jQuery(".button-primary.wpmui-ajax-update").data("before_ajax",e),jQuery(".override-slider").each(function(){t.apply(this)}).on("ms-ajax-done",t)},window.ms_init.view_settings_setup=function(){function e(e,t,i,a){var n;a||(n=i.split(":"),void 0!==n[1]&&(n.shift(),jQuery(".ms-nav-controls").replaceWith(n.join(":"))))}function t(){return n.show(),s.hide(),!1}function i(){return n.hide(),s.show(),!1}var a=jQuery(".ms-setup-pages-site"),n=a.find(".ms-setup-pages-site-form"),s=a.find(".ms-setup-pages-change-site"),r=a.find(".ms-setup-pages-cancel");jQuery(document).on("ms-ajax-updated","#create_menu",e),s.click(t),r.click(i)};